"use strict";angular.module("beerGameApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("beerGameApp").controller("MainCtrl",["$scope","Player","Config","MissionsDB",function(a,b,c,d){a.database=d,a.players=[new b,new b,new b,new b],a.config=c,a.state=c.STATE_OPENING,a.state=c.STATE_PRE_TURN,a.setState=function(b){a.state=b},a.toggleSidebar=function(){a.menuOpen=!a.menuOpen}}]),angular.module("beerGameApp").directive("userSelection",["Player","Config","$timeout",function(a,b,c){return{templateUrl:"views/user-selection.html",restrict:"E",link:function(d){var e=50;d.startGame=function(){console.log("A"),d.setState(b.STATE_PRE_TURN)},d.addPlayer=function(){var b=new a;d.players.push(b),c(function(){d.toggleEdit(b)},e)},d.toggleEdit=function(a){for(var b=0;b<d.players.length;b++){var c=d.players[b];c.edit=a==c?!c.edit:!1}}}}}]),angular.module("beerGameApp").factory("Player",["Avatars",function(a){var b=function(){this.avatar=a.getAvatar(),this.gender="male",this.attractedTo="female",this.step=0};return b}]),angular.module("beerGameApp").directive("playerItem",function(){return{templateUrl:"views/player-item.html",restrict:"E",link:function(){}}}),angular.module("beerGameApp").service("Config",function(){this.STATE_OPENING="opening",this.STATE_PRE_TURN="pre turn",this.STATE_TURN="turn",this.STATE_MENU="menu",this.POSITION_CURRENT="current",this.POSITION_PAST="past",this.POSITION_NEXT="next",this.POSITION_OUT="out",this.MISSION_TYPE_PRE_TURN="pre-turn",this.MISSION_TYPE_BONUS="bonus",this.MISSION_TYPE_PENALTY="penalty",this.MISSION_TYPE_TRUTH="truth",this.MISSION_TYPE_DARE="dare",this.DB_KEY="1ewfvl4LxyKlY45DELASkmw7mMIdNYwy4KGxsoSzwzXs",this.SPREADSHEET_URL="https://spreadsheets.google.com/feeds/list/"+this.DB_KEY+"/od6/public/values?alt=json"}),angular.module("beerGameApp").directive("mainGame",function(){return{templateUrl:"views/main-game.html",restrict:"E",link:function(a){a.currentPlayer=0,a.nextPlayer=function(){a.currentPlayer++,a.currentPlayer==a.players.length&&(a.currentPlayer-=a.players.length)}}}}),angular.module("beerGameApp").directive("currentPlayer",["Config",function(a){return{restrict:"E",templateUrl:"views/current-player.html",link:function(b){var c=b.players.length;b.$watch("currentPlayer",function(d){if(c>1)for(var e=0;e<b.players.length;e++){var f=b.players[e];e==d?(f.position=a.POSITION_CURRENT,2==c&&(f.position+=" dual ")):2==c?e!=d&&(f.position=a.POSITION_OUT+" dual"):(f.position=(e+1)%c==d?a.POSITION_NEXT:(e+c-1)%c==d?a.POSITION_PAST:a.POSITION_OUT,4==c&&(f.position+=" max"))}})}}}]),angular.module("beerGameApp").service("Avatars",function(){var a=["images/jinjo.png","images/dudi.jpg","images/oizo.jpg","images/tom.jpg"];this.getAvatar=function(){if(0==a.length)return"";var b=Math.round(Math.random()*(a.length-1));return a.splice(b,1)[0]}}),angular.module("beerGameApp").directive("missionCard",function(){return{restrict:"E",templateUrl:"views/mission-card.html",link:function(a){a.mission=a.database.getRandomPreTurn()}}}),angular.module("beerGameApp").factory("Mission",function(){function a(a){var b=a.split("-");return{text:b[0],action:b[1]}}var b=function(b){var c=this;if(b){var d;c.buttons=[],c.id=b.title.$t,b.content.$t=b.content.$t.replace(/, /g,","),angular.forEach(b.content.$t.split(","),function(a){d=a.split(": "),c[d[0]]=d[1]}),c.buttons.push(a(c.button1)),c.button2&&c.buttons.push(a(c.button2))}else c.id=0,c.type="pre-turn",c.buttons=[{text:"שחק",action:"nextPlayer"}],c.text="האם זה טקסט?",c.points="1"};return b}),angular.module("beerGameApp").service("MissionsDB",["$http","Config","Mission",function(a,b,c){function d(a){var d=a.feed.entry,e={};angular.forEach(d,function(a){e=new c(a),e.type==b.MISSION_TYPE_PRE_TURN?f.preTurns.push(e):f.missions.push(e)}),f.isLoaded=!0,console.log(f.missions),console.log(f.preTurns)}function e(a){return a[Math.round(Math.random()*(a.length-1))]}this.isLoaded=!1;var f=this;this.missions=[],this.preTurns=[],this.getRandomMission=function(){return e(f.missions)},this.getRandomPreTurn=function(){return e(f.preTurns)},a.get(b.SPREADSHEET_URL).then(function(a){d(a.data)})}]);